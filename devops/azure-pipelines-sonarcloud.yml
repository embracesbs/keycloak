trigger:
- release-embrace

variables:
#- name: Version.Major
#  value: 10
#- name: Version.Minor
#  value: 0
#- name: Version.Patch
#  value: 2
#- name: Version.Tag
#  value: $(Version.Major).$(Version.Minor).$(Version.Patch)
#- name: Version.Revision
#  value: $[counter(variables['Version.Tag'], 0)]
#- name: Version
#  value: $(Version.Tag)-$(Version.Revision)
#- name: Docker.ServiceConnectionName
#  value: 'embraceclouddocker'
#- name: Docker.Registry
#  value: 'embraceclouddocker.azurecr.io' 
#- name: Docker.Repository.Name
#  value: keycloak-embrace-jdk
- group: var-identity-keycloak-build
- name: MAVEN_CACHE_FOLDER
  value: $(Pipeline.Workspace)/.m2/repository
- name: MAVEN_OPTS
  value: ''

pool:
  vmImage: 'ubuntu-latest'

steps:

- task: Cache@2
  inputs:
    key: 'maven | "$(Agent.OS)" | **/pom.xml'
    restoreKeys: |
      maven | "$(Agent.OS)"
      maven
    path: $(MAVEN_CACHE_FOLDER)
  displayName: Cache Maven local repo

- script: |
    echo "Hello sonar!"
    mvn install
    mvn verify org.sonarsource.scanner.maven:sonar-maven-plugin:sonar -Dsonar.projectKey=identity-keycloak -DskipTests=true -Dmaven.repo.local=$(MAVEN_CACHE_FOLDER)
  env:
    SONAR_TOKEN: $(sonarcloud-project-sonar-token)
  # workingDirectory: #
  failOnStderr: true
  displayName: Sonarcloud
